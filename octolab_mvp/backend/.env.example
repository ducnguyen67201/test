# =============================================================================
# OctoLab Backend Configuration
# =============================================================================
# Single consolidated environment file.
#
# Setup:
#   cp .env.example .env
#   chmod 600 .env  # Protect secrets
#   # Edit .env with your values
# =============================================================================

# =============================================================================
# Environment
# =============================================================================
APP_ENV=development

# =============================================================================
# Database
# =============================================================================
# PostgreSQL connection string (psycopg driver for sync, asyncpg for tests)
DATABASE_URL=postgresql+psycopg://octolab:your_password@localhost:5432/octolab

# =============================================================================
# Security Secrets (REQUIRED - generate unique values!)
# =============================================================================
# JWT signing secret (generate with: openssl rand -hex 32)
SECRET_KEY=CHANGE_ME_generate_with_openssl_rand_hex_32

# Evidence HMAC secret (generate with: openssl rand -hex 32)
EVIDENCE_HMAC_SECRET=CHANGE_ME_generate_with_openssl_rand_hex_32

# Internal API token for Falco integration (generate with: openssl rand -hex 32)
INTERNAL_TOKEN=CHANGE_ME_generate_with_openssl_rand_hex_32

# Service token for frontend-to-backend calls (generate with: python -c "import secrets; print(secrets.token_urlsafe(32))")
# OCTOLAB_SERVICE_TOKEN=your_service_token

# =============================================================================
# Application Settings
# =============================================================================
ACCESS_TOKEN_EXPIRE_MINUTES=60
LOG_LEVEL=INFO
ALLOW_SELF_SIGNUP=false

# Admin email addresses (comma-separated) for privileged operations
OCTOLAB_ADMIN_EMAILS=admin@example.com

# CORS origins (comma-separated)
# CORS_ORIGINS=http://localhost:3000

# =============================================================================
# Runtime Configuration
# =============================================================================
# Valid values: firecracker (production), compose (dev), k8s, noop
OCTOLAB_RUNTIME=firecracker

# Legacy paths (for compose runtime only)
# HACKVM_DIR=/path/to/octolab_mvp
# HACKVM_COMPOSE_PATH=/path/to/octolab-hackvm/docker-compose.yml

# =============================================================================
# Firecracker MicroVM Configuration
# =============================================================================
MICROVM_STATE_DIR=/var/lib/octolab/microvm
MICROVM_KERNEL_PATH=/var/lib/octolab/firecracker/vmlinux
MICROVM_ROOTFS_BASE_PATH=/var/lib/octolab/firecracker/rootfs.ext4
OCTOLAB_MICROVM_NETD_SOCK=/run/octolab/microvm-netd.sock

# Firecracker binaries
FIRECRACKER_BIN=firecracker
JAILER_BIN=jailer

# MicroVM resource limits
MICROVM_BOOT_TIMEOUT_SECS=90
MICROVM_VCPU_COUNT=2
MICROVM_MEM_SIZE_MIB=2048

# =============================================================================
# VNC/noVNC Configuration
# =============================================================================
VNC_BASE_URL=https://your-domain.com/vnc/vnc.html
HACKVM_PUBLIC_HOST=your-domain.com
NOVNC_BIND_ADDR=127.0.0.1
NOVNC_PORT_MIN=30000
NOVNC_PORT_MAX=39999

# =============================================================================
# Guacamole Configuration (Remote Desktop)
# =============================================================================
GUAC_ENABLED=true
GUAC_BASE_URL=http://127.0.0.1:8081/guacamole
GUAC_ADMIN_USER=guacadmin
GUAC_ADMIN_PASSWORD=guacadmin
GUACD_CONTAINER_NAME=octolab-guacd

# Fernet encryption key for per-lab Guacamole passwords
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
# IMPORTANT: Once set, NEVER change this key or existing labs will fail!
GUAC_ENC_KEY=CHANGE_ME_generate_fernet_key

# =============================================================================
# Quotas and Limits
# =============================================================================
MAX_ACTIVE_LABS_PER_USER=2
MAX_LAB_CREATES_PER_HOUR_PER_USER=10
DEFAULT_LAB_TTL_MINUTES=120

# =============================================================================
# Teardown Worker
# =============================================================================
TEARDOWN_WORKER_ENABLED=true
TEARDOWN_WORKER_INTERVAL_SECONDS=5.0

# =============================================================================
# Notification Settings (Slack & Discord Webhooks)
# =============================================================================
# Slack webhook for instant alerts (optional)
# OCTOLAB_SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx/yyy/zzz

# Discord webhook for instant alerts (optional)
# Create in Discord: Server Settings > Integrations > Webhooks > New Webhook
# OCTOLAB_DISCORD_WEBHOOK_URL=https://discord.com/api/webhooks/xxx/yyy
